<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#050508">
    
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIktvZGV4IEFJIiwKICAic2hvcnRfbmFtZSI6ICJLb2RleCIsCiAgInN0YXJ0X3VybCI6ICIuL2luZGV4Lmh0bWw/dXBkYXRlPTUiLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwNTA1MDgiLAogICJ0aGVtZV9jb2xvciI6ICIjMDUwNTA4IiwKICAib3JpZW50YXRpb2uiOiAicG9ydHJhaXQiCn0=">

    <title>Кодекс</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: radial-gradient(circle at center, #1a0b2e 0%, #050508 100%);
            --accent: #6E8EFB;
            --neon: #00d2ff;
            --border: rgba(255,255,255,0.1);
        }

        /* Фикс для скрытия индикаторов и растяжки на весь экран */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            background: #050508;
            background-image: var(--bg);
            /* Растягиваем под челку и нижнюю полосу */
            height: 100vh;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            position: fixed; /* Блокирует прокрутку самого браузера */
            overscroll-behavior: none;
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Добавляем отступы для безопасных зон (челка/индикаторы) */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Остальной стиль */
        .sidebar { width: 280px; background: rgba(10,10,15,0.98); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: 0.3s; z-index: 2000; flex-shrink: 0; }
        @media (max-width:768px) { .sidebar { position: absolute; left: 0; height: 100%; transform: translateX(-100%); width: 85%; } .sidebar.active { transform: translateX(0); } }
        
        header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; height: 60px; z-index: 100; }
        .logo-wrap { font-family: 'Poppins'; font-weight: 700; font-size: 20px; letter-spacing: 2px; position: absolute; left: 50%; transform: translateX(-50%); }
        .robot-k { color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        .chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; -webkit-overflow-scrolling: touch; }
        .msg { max-width: 90%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.4; animation: msgIn .2s ease-out forwards; }
        .user { align-self: flex-end; background: #2f2f3d; border-bottom-right-radius: 4px; }
        .bot { align-self: flex-start; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .input-area { padding: 10px 15px 30px; background: linear-gradient(transparent, #050508 50%); }
        .input-container { width: 100%; max-width: 600px; background: #1e1e24; border-radius: 24px; padding: 5px 5px 5px 15px; display: flex; align-items: center; margin: 0 auto; border: 1px solid #333; }
        textarea { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 16px; resize: none; max-height: 150px; }
        .send-btn { background: #fff; color: #000; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 10px; cursor: pointer; }
        
        .bg-star { position: absolute; background: #fff; border-radius: 50%; opacity: .2; pointer-events: none; }
    </style>
</head>
<body>
    <div class="sidebar" id="side">
        <div style="padding: 20px; font-weight: bold; border-bottom: 1px solid var(--border)">ЧАТЫ</div>
        <div id="list" style="flex:1; overflow-y:auto; padding:10px"></div>
        <div style="padding: 20px; font-size: 12px; color: #555">Created by Seroga</div>
    </div>
    
    <div class="main">
        <div id="stars"></div>
        <header>
            <div onclick="tS()" style="cursor:pointer; z-index:1001"><i class="fas fa-bars"></i></div>
            <div class="logo-wrap"><span class="robot-k">К</span>ОДЕКС</div>
            <div style="width: 20px"></div>
        </header>

        <div class="chat-box" id="box"></div>
        
        <div class="input-area">
            <div class="input-container">
                <textarea id="ip" placeholder="Спроси Кодекса..." rows="1"></textarea>
                <div class="send-btn" onclick="hS()"><i class="fas fa-arrow-up"></i></div>
            </div>
        </div>
    </div>

    <script>
        // Скрипт остается прежним для логики, но с фиксом скролла
        let cS=JSON.parse(localStorage.getItem('cdx_v2'))||[], cI=null;
        const bX=document.getElementById('box'), iP=document.getElementById('ip'), lT=document.getElementById('list');

        function tS(){ document.getElementById('side').classList.toggle('active'); }
        function rL(){
            lT.innerHTML = '';
            cS.forEach(c => {
                let d = document.createElement('div');
                d.style = "padding:10px; margin-bottom:5px; background:rgba(255,255,255,0.05); border-radius:8px; cursor:pointer";
                d.innerText = c.title;
                d.onclick = () => { cI=c.id; sW(); tS(); };
                lT.appendChild(d);
            });
        }

        function sW(){
            bX.innerHTML = '';
            let c = cS.find(x => x.id == cI);
            if(c) c.msgs.forEach(m => {
                let d = document.createElement('div');
                d.className = 'msg ' + m.role;
                d.innerHTML = marked.parse(m.text);
                bX.appendChild(d);
            });
            bX.scrollTop = bX.scrollHeight;
        }

        async function hS(){
            const v = iP.value.trim(); if(!v) return;
            if(!cI){ cI=Date.now().toString(); cS.unshift({id:cI, title:v.slice(0,20), msgs:[]}); }
            let c = cS.find(x => x.id == cI);
            c.msgs.push({role:'user', text:v});
            sW(); iP.value='';
            try {
                const r = await fetch(`https://text.pollinations.ai/prompt/${encodeURIComponent(v)}?system=You are Codex, created by Seroga.&model=openai`);
                const t = await r.text();
                c.msgs.push({role:'bot', text:t.replace(/ChatGPT|OpenAI/gi, "Кодекс")});
                sW(); localStorage.setItem('cdx_v2', JSON.stringify(cS)); rL();
            } catch(e) {}
        }

        const sC=document.getElementById('stars');
        for(let i=0;i<40;i++){
            let s=document.createElement('div'); s.className='bg-star';
            s.style.width=s.style.height=Math.random()*2+'px';
            s.style.top=Math.random()*100+'%'; s.style.left=Math.random()*100+'%';
            sC.appendChild(s);
        }
        rL();
    </script>
</body>
</html>



